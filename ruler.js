!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=6)}([function(t,e,i){var n=i(2),o=i(4);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var s={insert:"head",singleton:!1};n(o,s);t.exports=o.locals||{}},function(t,e,i){var n=i(2),o=i(5);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var s={insert:"head",singleton:!1};n(o,s);t.exports=o.locals||{}},function(t,e,i){"use strict";var n,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},s=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),r=[];function a(t){for(var e=-1,i=0;i<r.length;i++)if(r[i].identifier===t){e=i;break}return e}function l(t,e){for(var i={},n=[],o=0;o<t.length;o++){var s=t[o],l=e.base?s[0]+e.base:s[0],h=i[l]||0,d="".concat(l," ").concat(h);i[l]=h+1;var u=a(d),c={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(r[u].references++,r[u].updater(c)):r.push({identifier:d,updater:m(c,e),references:1}),n.push(d)}return n}function h(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var o=i.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var r=s(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var d,u=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function c(t,e,i,n){var o=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=u(e,o);else{var s=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function p(t,e,i){var n=i.css,o=i.media,s=i.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var g=null,v=0;function m(t,e){var i,n,o;if(e.singleton){var s=v++;i=g||(g=h(e)),n=c.bind(null,i,s,!1),o=c.bind(null,i,s,!0)}else i=h(e),n=p.bind(null,i,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var i=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var o=a(i[n]);r[o].references--}for(var s=l(t,e),h=0;h<i.length;h++){var d=a(i[h]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}i=s}}}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var o=(r=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(s).concat([o]).join("\n")}var r,a,l;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(n)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(o[r]=!0)}for(var a=0;a<t.length;a++){var l=[].concat(t[a]);n&&o[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),e.push(l))}},e}},function(t,e,i){(e=i(3)(!1)).push([t.i,".src-index-module__cross {\n    user-select: none;\n    width: 24px;\n    height: 24px;\n    margin-top: -4px;\n    cursor: pointer;\n}\n\n.src-index-module__label {\n    font-size: 13px;\n    color: #667799;\n    user-select: none;\n    font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n    text-shadow: 1px 0 1px #fff, -1px 0 1px #fff, 0 1px 1px #fff, 0 -1px 1px #fff;\n    white-space: nowrap;\n    cursor: pointer;\n}\n\n.src-index-module__joint {\n    user-select: none;\n    position: absolute;\n    width: 0;\n    height: 0;\n    top: -4px;\n    left: -4px;\n    background: #ffffff;\n    border-radius: 50%;\n    border-style: solid;\n    border-color: #667799;\n    border-width: 4px;\n    box-shadow: 0 0 0 2px #ffffff;\n    cursor: pointer;\n}\n.src-index-module__joint.src-index-module__big {\n    width: 7px;\n    height: 7px;\n    top: -6px;\n    left: -6px;\n    border-width: 3px;\n}\n\n.src-index-module__snap {\n    text-shadow: 1px 0 1px #fff, -1px 0 1px #fff, 0 1px 1px #fff, 0 -1px 1px #fff;\n    user-select: none;\n    color: #667799;\n    font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n    font-size: 13px;\n    margin: -6px 0 0 12px; /** отступы от точки наведения */\n    white-space: nowrap;\n    cursor: pointer;\n}\n",""]),e.locals={cross:"src-index-module__cross",label:"src-index-module__label",joint:"src-index-module__joint",big:"src-index-module__big",snap:"src-index-module__snap"},t.exports=e},function(t,e,i){(e=i(3)(!1)).push([t.i,".src-control-index-module__root {\n    background: #fff;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n    border-radius: 4px;\n    width: 32px;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n.src-control-index-module__button {\n    padding: 0;\n    outline: 0;\n    border: none;\n    cursor: pointer;\n\n    width: 32px;\n    height: 32px;\n    color: #262626;\n    box-sizing: border-box;\n\n    font-size: 18px;\n    font-weight: 400;\n\n    background: #fff;\n}\n\n.src-control-index-module__button:hover {\n    opacity: 0.7;\n}\n\n.src-control-index-module__button:active {\n    color: #028eff;\n}\n\n.src-control-index-module__enabled {\n    color: #028eff;\n}\n",""]),e.locals={root:"src-control-index-module__root",button:"src-control-index-module__button",enabled:"src-control-index-module__enabled"},t.exports=e},function(t,e,i){"use strict";i.r(e),i.d(e,"Ruler",(function(){return _})),i.d(e,"RulerControl",(function(){return k}));class n{constructor(){this.events={}}on(t,e){let i=this.events[t];return i||(i=this.events[t]=[]),i.push(e),this}once(t,e){const i=n=>{this.off(t,i),e.call(this,n)};return this.on(t,i),this}off(t,e){const i=this.events[t];if(!i)return this;const n=i.indexOf(e);return-1!==n&&i.splice(n,1),this}emit(t,e){const i=this.events[t];if(!i)return this;const n=i.slice();for(let t=0;t<n.length;t++)n[t].call(this,e);return this}}const o={start:{en:"Start",ru:"Старт"},addPoint:{en:"Add point",ru:"Добавить точку"},meter:{en:"m",ru:"м"},kilometer:{en:"km",ru:"км"}};function s(t,e="en"){var i;return null!==(i=o[t][e])&&void 0!==i?i:o[t].en}const r={popupLabelPhase:2147483647,jointLabelPhase:2147483646,areaLabelPhase:2147483645,linePhase:2147483644,jointPhase:2147483643,areaPhase:2147483642,areaColor:"#8899bb77",areaStrokeWidth:0,jointWidth:7,jointBorderWidth:3,jointBorder2Width:2,lineWidth:4,lineBorderWidth:2,lineBorder2Width:1,lineColor:"#667799",lineBorderColor:"#ffffff",lineBorder2Color:"#00000026",previewLineColor:"#66779966",labelFontSize:13,labelColor:"#556688",labelHaloColor:"#fff"};var a=i(0),l=i.n(a);function h(t,e,i){if(void 0===t)return"";if(i=i.toLowerCase(),e)return s("start",i);if(t<1e3)return`${t} ${s("meter",i)}`;return`${(t/1e3).toFixed(1)} ${s("kilometer",i)}`}function d(t,e){const i=Math.PI/180,n=t[1]*i,o=e[1]*i,s=Math.sin((e[1]-t[1])*i/2),r=Math.sin((e[0]-t[0])*i/2),a=s*s+Math.cos(n)*Math.cos(o)*r*r,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return Math.round(6371e3*l)}function u(t,e,i){return new mapgl.Polyline(t,{coordinates:e,zIndex:r.linePhase,zIndex2:r.linePhase-1e-5,zIndex3:r.linePhase-2e-5,width:r.lineWidth,width2:i?0:r.lineWidth+2*r.lineBorderWidth,width3:i?0:r.lineWidth+2*(r.lineBorderWidth+r.lineBorder2Width),color:i?r.previewLineColor:r.lineColor,color2:r.lineBorderColor,color3:r.lineBorder2Color,interactive:!i})}function c(t){return`<div class=${l.a.label}>${t}</div>`}function p(t,e,i){var n;return new mapgl.HtmlMarker(t,{coordinates:e,html:`<div class="${l.a.joint}${i.big?" "+l.a.big:""}"></div`,zIndex:r.jointPhase,interactive:null!==(n=i.interactive)&&void 0!==n&&n})}function g(t,e,i){const n=t[0]-e[0],o=t[1]-e[1],s=i[0]-e[0],r=i[1]-e[1],a=s*s+r*r,l=0!==a?(n*s+o*r)/a:0;return l<0?e:l>1?i:[e[0]+l*s,e[1]+l*r]}function v(t,e,i){var n;const o=e.map(e=>t.project(e.getCoordinates()));let s=1/0,r=o[0],a=0;for(let t=0;t<o.length;t++){const e=g(i,o[t],null!==(n=o[t+1])&&void 0!==n?n:o[0]),l=e[0]-i[0],h=e[1]-i[1],d=l*l+h*h;d<s&&(s=d,r=e,a=t)}const l=t.unproject(r);return{point:l,distance:e[a].getDistance()+d(l,e[a].getCoordinates()),segment:a}}function m(t,e,i){const n=t.getBoundingClientRect();return[e-n.left-t.clientLeft,i-n.top-t.clientTop]}let f=0;class b extends n{constructor(t,e,i,n,o,s){super(),this.map=t,this.showLabel=s,this.dragging=!1,this.hovered=!1,this.onClickPopup=()=>{this.disable(),this.emit("removed",{targetData:this})},this.onMouseOver=()=>{this.hovered||(this.hovered=!0,void 0===this.hoverTimer&&this.emit("mouseover",{targetData:this}))},this.onMouseOut=()=>{this.hovered&&(this.hovered=!1,this.hoverTimer=setTimeout(()=>{this.hovered||(this.emit("mouseout",{targetData:this}),this.hoverTimer=void 0)},100))},this.onMouseMove=t=>{var e;if(!this.dragging)return;this.emit("move",{targetData:this});const i=this.map.getContainer();if("touchmove"===t.type){const e=void 0===t.originalEvent?t:t.originalEvent,n=e.touches[0]||e.changedTouches[0];this.coordinates=this.map.unproject(m(i,n.pageX,n.pageY))}else"mousemove"===t.type&&(this.coordinates=this.map.unproject(m(i,t.clientX,t.clientY)));null===(e=this.marker)||void 0===e||e.setCoordinates(this.coordinates)},this.onMouseUp=()=>{this.dragging&&(this.dragging=!1,this.emit("dragend"))},this.omMouseDown=()=>{this.disablePopup(),this.dragging=!0,this.emit("dragstart",{targetData:this})},this.id=++f,this.distance=n,this.coordinates=e,this.isFirst=i,this.popup=function(t,e){const i=r.labelFontSize,n=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(t,{coordinates:e,html:"",anchor:[-n/2,i/2],zIndex:r.popupLabelPhase,interactive:!0})}(this.map,this.coordinates),o&&this.enable()}destroy(){this.disable(),this.popup.destroy()}disable(){var t,e;this.disablePopup(),null===(t=this.marker)||void 0===t||t.destroy(),this.marker=void 0,null===(e=this.label)||void 0===e||e.destroy(),this.label=void 0,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}enable(){this.marker=p(this.map,this.getCoordinates(),{big:this.isFirst,interactive:!0}),this.addMarkerEventListeners(),this.updateLabel(),document.addEventListener("touchmove",this.onMouseMove),document.addEventListener("mousemove",this.onMouseMove)}getCoordinates(){return this.coordinates}getDistance(){return this.distance}isFirstJoint(){return this.isFirst}setDistance(t,e){this.distance=t,this.isFirst=e,this.hovered?this.enablePopup():this.disablePopup()}setAsFirstJoint(){var t;this.isFirst||(this.isFirst=!0,null===(t=this.marker)||void 0===t||t.destroy(),document.removeEventListener("mouseup",this.onMouseUp),this.marker=p(this.map,this.coordinates,{big:this.isFirst,interactive:!0}),this.addMarkerEventListeners(),this.setDistance(0,!0))}enablePopup(){var t;null===(t=this.label)||void 0===t||t.destroy(),this.popup.setCoordinates(this.coordinates),this.popup.setContent(`<img class=${l.a.cross} src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjIiIGhlaWdodD0iMjIiPjxkZWZzPjxwYXRoIGlkPSJBIiBkPSJNMTIgMTAuNTg2bDMuNzkzLTMuNzkzIDEuNDE0IDEuNDE0TDEzLjQxNCAxMmwzLjc5MyAzLjc5My0xLjQxNCAxLjQxNEwxMiAxMy40MTRsLTMuNzkzIDMuNzkzLTEuNDE0LTEuNDE0TDEwLjU4NiAxMiA2Ljc5MyA4LjIwN2wxLjQxNC0xLjQxNEwxMiAxMC41ODZ6Ii8+PC9kZWZzPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEgLTEpIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMC41IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1vcGFjaXR5PSIuMTUiLz48bWFzayBpZD0iQiIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjQSIvPjwvbWFzaz48dXNlIGZpbGw9IiMwMDAiIGZpbGwtcnVsZT0ibm9uemVybyIgeGxpbms6aHJlZj0iI0EiLz48ZyBmaWxsPSIjMjYyNjI2IiBtYXNrPSJ1cmwoI0IpIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6Ii8+PC9nPjwvZz48L3N2Zz4=" alt="close">`),this.addPopupEventListeners()}disablePopup(){this.popup.setContent(""),this.updateLabel()}setLabelVisibility(t){this.showLabel=t,this.updateLabel()}updateLabel(){var t;null===(t=this.label)||void 0===t||t.destroy(),this.showLabel&&(this.label=function(t,e,i,n){const o=r.labelFontSize,s=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(t,{coordinates:e,html:c(h(i,n,t.getLanguage())),anchor:[-s/2-2,o/2],zIndex:r.jointLabelPhase,interactive:!1})}(this.map,this.coordinates,this.distance,this.isFirst))}addMarkerEventListeners(){if(!this.marker)return;const t=this.marker.getContent();t.addEventListener("mousedown",this.omMouseDown),t.addEventListener("touchstart",this.omMouseDown),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onMouseUp),t.addEventListener("mouseover",this.onMouseOver),t.addEventListener("mouseout",this.onMouseOut)}addPopupEventListeners(){const t=this.popup.getContent();t.addEventListener("mouseover",this.onMouseOver),t.addEventListener("mouseout",this.onMouseOut),t.addEventListener("click",this.onClickPopup)}}class y{constructor(t,e){this.map=t,this.showLabel=e,this.point=[0,0],this.distance=0}update(t){void 0!==t?(this.point=t.point,this.distance=t.distance,this.marker?this.marker.setCoordinates(this.point):this.marker=p(this.map,this.point,{big:!0,interactive:!1}),this.updateLabel()):this.destroy()}destroy(){var t,e;null===(t=this.label)||void 0===t||t.destroy(),null===(e=this.marker)||void 0===e||e.destroy(),this.label=void 0,this.marker=void 0,this.point=[0,0],this.distance=0}setLabelVisibility(t){this.showLabel=t,this.updateLabel()}updateLabel(){var t;null===(t=this.label)||void 0===t||t.destroy(),this.showLabel&&(this.label=function(t,e,i){const n=c(function(t,e){const i=t.getLanguage().toLowerCase(),n=h(e,!1,i),o=s("addPoint",i);return r=n,a=o,`<div class=${l.a.snap}>${r}<br>${a}</div>`;var r,a}(t,i)),o=r.labelFontSize,a=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(t,{coordinates:e,html:n,anchor:[-a/2,o/2],zIndex:r.jointLabelPhase,interactive:!1})}(this.map,this.point,this.distance))}}const w=t=>t*Math.PI/180;function x(t){const e=t.reduce((t,e)=>({sumX:t.sumX+e[0],sumY:t.sumY+e[1],count:t.count+1}),{sumX:0,sumY:0,count:0});return[e.sumX/e.count,e.sumY/e.count]}class L{constructor(t,e,i){if(this.map=t,this.showLabel=i,this.area=0,this.perimeter=0,this.centroid=[0,0],e.length>2){const t=e.map(t=>t.getCoordinates());this.polygon=M(this.map,t),this.centroid=x(t),this.updateLabel()}}update(t){var e,i;if(null===(e=this.polygon)||void 0===e||e.destroy(),t.length<=2)return this.perimeter=0,this.area=0,void(null===(i=this.label)||void 0===i||i.destroy());const n=t.map(t=>t.getCoordinates());this.centroid=x(n),this.perimeter=t[t.length-1].getDistance()+d(n[n.length-1],n[0]),this.area=function(t){if(t.length<=2)return 0;let e,i,n,o=0;return t.forEach((s,r)=>{e=s,i=t[(r+1)%t.length],n=t[(r+2)%t.length],o+=Math.sin(w(i[1]))*(w(n[0])-w(e[0]))}),o=Math.abs(6371008.8*o*6371008.8)/2,o}(n),this.polygon=M(this.map,n),this.updateLabel()}destroy(){var t,e;null===(t=this.label)||void 0===t||t.destroy(),null===(e=this.polygon)||void 0===e||e.destroy()}getArea(){return this.area}getPerimeter(){return this.perimeter}setLabelVisibility(t){this.showLabel=t,this.updateLabel()}updateLabel(){var t,e,i,n;null===(t=this.label)||void 0===t||t.destroy(),this.showLabel&&(this.label=(e=this.map,i=this.centroid,n=this.area,new mapgl.Label(e,{coordinates:i,text:C(n,e.getLanguage()),zIndex:r.areaLabelPhase,fontSize:r.labelFontSize,color:r.labelColor,haloColor:r.labelHaloColor,haloRadius:1})))}}function C(t,e){return e=e.toLowerCase(),t<1e5?`${t.toFixed(1)} ${s("meter",e)}²`:`${(t/1e6).toFixed(1)} ${s("kilometer",e)}²`}function M(t,e){return new mapgl.Polygon(t,{coordinates:[e],zIndex:r.areaPhase,interactive:!1,color:r.areaColor,strokeWidth:r.areaStrokeWidth})}class j{constructor(t){this.map=t}destroy(){var t;null===(t=this.polyline)||void 0===t||t.destroy(),this.draggableJoint=void 0}getDraggableJoint(){return this.draggableJoint}setDraggableJoint(t){this.draggableJoint=t}update(t,e){var i,n,o;if(null===(i=this.polyline)||void 0===i||i.destroy(),this.draggableJoint){const i=e.indexOf(this.draggableJoint);if(-1===i)return;const s=[];(e[i-1]||"polygon"===t)&&s.push((null!==(n=e[i-1])&&void 0!==n?n:e[e.length-1]).getCoordinates()),s.push(this.draggableJoint.getCoordinates()),(e[i+1]||"polygon"===t)&&s.push((null!==(o=e[i+1])&&void 0!==o?o:e[0]).getCoordinates()),this.polyline=u(this.map,s,!0)}}}class P extends n{constructor(t){super(),this.map=t}update(t,e){var i;if(null===(i=this.polyline)||void 0===i||i.destroy(),0===e.length)return;const n=e.map((t,i)=>{const n=t.getCoordinates(),o=0===i;let s=0;if(!o){s=e[i-1].getDistance()+d(n,e[i-1].getCoordinates())}return t.setDistance(s,o),n});"polygon"===t&&n.push(e[0].getCoordinates()),this.polyline=u(this.map,n,!1),this.polyline.on("mousemove",t=>this.emit("mousemove",t)),this.polyline.on("mouseout",t=>this.emit("mouseout",t)),this.polyline.on("click",t=>this.emit("click",t))}destroy(){var t;null===(t=this.polyline)||void 0===t||t.destroy()}}class _ extends n{constructor(t,e={}){var i,n,o,s,r,a,l,h,d;super(),this.enabled=!1,this.overed=!1,this.joints=[],this.onJointMouseOver=t=>{this.overed=!0,this.previewLine.getDraggableJoint()||t.targetData.enablePopup()},this.onJointMouseOut=t=>{this.overed=!1,this.previewLine.getDraggableJoint()||t.targetData.disablePopup()},this.onJointRemoved=t=>{const e=t.targetData,i=this.joints.indexOf(e);e.isFirstJoint()&&this.joints.length>1&&this.joints[i+1].setAsFirstJoint(),this.joints.splice(i,1),this.redrawFlags.polyline=!0,this.overed=!1,this.sendRulerChangeEvent(!0)},this.onJointMoveEnd=()=>{var t;this.redrawFlags.polyline=!0,this.redrawFlags.preview=!0,null===(t=this.previewLine.getDraggableJoint())||void 0===t||t.enablePopup(),this.previewLine.setDraggableJoint(void 0),this.sendRulerChangeEvent(!0)},this.onJointMove=()=>{this.redrawFlags.preview=!0},this.onJointMoveStart=t=>{t.targetData.disablePopup(),this.previewLine.setDraggableJoint(t.targetData)},this.onPolylineMouseMove=t=>{this.previewLine.getDraggableJoint()||this.overed||(this.newSnapInfo=v(this.map,this.joints,t.point),this.redrawFlags.snap=!0)},this.onPolylineMouseOut=()=>{this.redrawFlags.snap=!0},this.onPolylineClick=t=>{this.createSnapPoint(t.point),this.sendRulerChangeEvent(!0)},this.onClick=t=>{this.addPoint(t.lngLat,this.joints.length),this.sendRulerChangeEvent(!0)},this.map=t,this.mode=null!==(i=e.mode)&&void 0!==i?i:"polyline",this.language=this.map.getLanguage(),this.redrawFlags={polyline:!1,preview:!1,snap:!1},this.labelVisibilitySettings={snapPoint:null===(o=null===(n=e.labelVisibilitySettings)||void 0===n?void 0:n.snapPoint)||void 0===o||o,perimeter:null===(r=null===(s=e.labelVisibilitySettings)||void 0===s?void 0:s.perimeter)||void 0===r||r,area:null===(l=null===(a=e.labelVisibilitySettings)||void 0===a?void 0:a.area)||void 0===l||l},this.snapPoint=new y(this.map,this.labelVisibilitySettings.snapPoint),this.previewLine=new j(this.map),this.polyline=new P(this.map),this.polyline.on("mousemove",this.onPolylineMouseMove),this.polyline.on("mouseout",this.onPolylineMouseOut),this.polyline.on("click",this.onPolylineClick),null===(h=e.points)||void 0===h||h.forEach((t,e)=>this.addPoint(t,e)),(null===(d=e.enabled)||void 0===d||d)&&this.enable()}destroy(){this.disable(),this.joints.forEach(t=>t.destroy()),this.joints=[]}enable(){this.enabled||(this.enabled=!0,this.redrawFlags.polyline=!0,"polygon"===this.mode&&(this.polygon=new L(this.map,this.joints,this.labelVisibilitySettings.area)),this.map.on("click",this.onClick),this.joints.forEach(t=>t.enable()),this.update())}disable(){var t;this.enabled&&(this.enabled=!1,this.polyline.destroy(),this.previewLine.destroy(),this.snapPoint.destroy(),null===(t=this.polygon)||void 0===t||t.destroy(),this.polygon=void 0,this.joints.forEach(t=>t.disable()),this.map.off("click",this.onClick))}setPoints(t){this.redrawFlags.polyline=!0,this.joints.forEach(t=>t.destroy()),this.joints=[],t.forEach((t,e)=>this.addPoint(t,e)),this.sendRulerChangeEvent(!1)}getData(){var t,e,i,n,o,s;switch(this.mode){case"polyline":return{type:this.mode,coordinates:this.joints.map(t=>t.getCoordinates()),lengths:this.joints.map(t=>t.getDistance()),length:this.joints.length>0?null===(t=this.joints[this.joints.length-1])||void 0===t?void 0:t.getDistance():0};case"polygon":const r=this.joints.map(t=>t.getDistance());return(null===(e=this.polygon)||void 0===e?void 0:e.getPerimeter())&&r.push(this.polygon.getPerimeter()),{type:this.mode,coordinates:[this.joints.map(t=>t.getCoordinates())],area:null!==(n=null===(i=this.polygon)||void 0===i?void 0:i.getArea())&&void 0!==n?n:0,perimeter:null!==(s=null===(o=this.polygon)||void 0===o?void 0:o.getPerimeter())&&void 0!==s?s:0,lengths:r};default:throw new Error("unknown mode: "+this.mode)}}setLabelsVisibility(t){var e,i,n,o;this.labelVisibilitySettings={snapPoint:null===(e=t.snapPoint)||void 0===e||e,area:null===(i=t.area)||void 0===i||i,perimeter:null===(n=t.perimeter)||void 0===n||n},this.snapPoint.setLabelVisibility(this.labelVisibilitySettings.snapPoint),null===(o=this.polygon)||void 0===o||o.setLabelVisibility(this.labelVisibilitySettings.area),this.joints.forEach(t=>t.setLabelVisibility(this.labelVisibilitySettings.perimeter)),this.emit("redraw")}addPoint(t,e){this.redrawFlags.polyline=!0;const i=0===this.joints.length;let n=0;if(!i){const i=this.joints[e-1];n=i.getDistance()+d(i.getCoordinates(),t)}const o=new b(this.map,t,i,n,this.enabled,this.labelVisibilitySettings.perimeter);o.on("dragstart",this.onJointMoveStart),o.on("dragend",this.onJointMoveEnd),o.on("move",this.onJointMove),o.on("removed",this.onJointRemoved),o.on("mouseover",this.onJointMouseOver),o.on("mouseout",this.onJointMouseOut),this.joints.splice(e,0,o)}createSnapPoint(t){const e=v(this.map,this.joints,t);this.addPoint(e.point,e.segment+1),this.redrawFlags.snap=!0}sendRulerChangeEvent(t){this.emit("change",{data:this.getData(),isUser:t})}changeLanguage(){var t;this.language=this.map.getLanguage(),this.joints.forEach(t=>t.updateLabel()),this.snapPoint.updateLabel(),null===(t=this.polygon)||void 0===t||t.updateLabel()}update(){var t;if(!this.enabled)return;let e=this.redrawFlags.snap||this.redrawFlags.preview||this.redrawFlags.polyline;this.language!==this.map.getLanguage()&&(this.changeLanguage(),e=!0),this.redrawFlags.polyline&&(this.redrawFlags.polyline=!1,null===(t=this.polygon)||void 0===t||t.update(this.joints),this.polyline.update(this.mode,this.joints)),this.redrawFlags.preview&&(this.redrawFlags.preview=!1,this.previewLine.update(this.mode,this.joints)),this.redrawFlags.snap&&(this.redrawFlags.snap=!1,this.snapPoint.update(this.newSnapInfo),this.newSnapInfo=void 0),e&&this.emit("redraw"),requestAnimationFrame(()=>{this.update()})}}var E=i(1),I=i.n(E);class k extends class{constructor(t,e,i){var n;const{position:o}=i;this._wrap=document.createElement("div"),this._wrap.style.userSelect="none",this._wrap.innerHTML=e,this._position=o,this._controlPane=t._controlPane,this._container=this._controlPane.getContainerByPosition(o),null===(n=this._container)||void 0===n||n.append(this._wrap)}destroy(){this._wrap.remove()}getPosition(){return this._position}setPosition(t){this._container.removeChild(this._wrap),this._container=this._controlPane.getContainerByPosition(t),this._container.append(this._wrap),this._position=t}getContainer(){return this._wrap}}{constructor(t,e){var i,n;super(t,"",e),this.map=t,this.render=()=>{this.getContainer().innerHTML=`\n            <div class=${I.a.root}>\n                <button class="${I.a.button}${this.isEnabled?" "+I.a.enabled:""}"> ${this.icon}</button>\n            </div>\n        `;this.getContainer().querySelector("."+I.a.button).addEventListener("click",this.onClick)},this.onClick=()=>{this.isEnabled?(this.ruler.destroy(),this.isEnabled=!1):(this.ruler.enable(),this.isEnabled=!0),this.render()};const o=null!==(i=e.mode)&&void 0!==i?i:"polyline";switch(this.isEnabled=null===(n=e.enabled)||void 0===n||n,o){case"polyline":this.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="currentColor">\n    <path d="M19 5.59L5.59 19 13 26.41 26.41 13zM8.41 19L10 17.41l2.29 2.3 1.42-1.42-2.3-2.29L13 14.41l2.29 2.3 1.42-1.42-2.3-2.29L16 11.41l2.29 2.3 1.42-1.42-2.3-2.29L19 8.41 23.59 13 13 23.59z" />\n</svg>\n';break;case"polygon":this.icon='<svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M10.7324 8C10.3866 7.4022 9.74028 7 9 7C7.89543 7 7 7.89543 7 9C7 9.74028 7.4022 10.3866 8 10.7324V20V21.2676C7.4022 21.6134 7 22.2597 7 23C7 24.1046 7.89543 25 9 25C9.74028 25 10.3866 24.5978 10.7324 24H21.2676C21.6134 24.5978 22.2597 25 23 25C24.1046 25 25 24.1046 25 23C25 22.2597 24.5978 21.6134 24 21.2676V16.7324C24.5978 16.3866 25 15.7403 25 15C25 13.8954 24.1046 13 23 13C22.8208 13 22.6472 13.0236 22.482 13.0677L18.9323 9.51804C18.9764 9.35282 19 9.17916 19 9C19 7.89543 18.1046 7 17 7C16.2597 7 15.6134 7.4022 15.2676 8H12H10.7324ZM10.7324 22H21.2676C21.4432 21.6964 21.6964 21.4432 22 21.2676V16.7324C21.4022 16.3866 21 15.7403 21 15C21 14.8208 21.0236 14.6472 21.0677 14.482L17.518 10.9323C17.3528 10.9764 17.1792 11 17 11C16.2597 11 15.6134 10.5978 15.2676 10H12H10.7324C10.5568 10.3036 10.3036 10.5568 10 10.7324V20V21.2676C10.3036 21.4432 10.5568 21.6964 10.7324 22Z"/>\n</svg>\n';break;default:throw new Error("unsupported mode: "+o)}this.ruler=new _(this.map,{enabled:this.isEnabled,mode:o}),this.render()}destroy(){this.ruler.destroy(),super.destroy()}getRuler(){return this.ruler}toggle(){this.onClick()}}"undefined"!=typeof window&&("mapgl"in window?(mapgl.Ruler=_,mapgl.RulerControl=k):(window.__mapglPlugins||(window.__mapglPlugins={}),window.__mapglPlugins.Ruler=_,window.__mapglPlugins.RulerControl=k))}])}));