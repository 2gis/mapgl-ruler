!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=6)}([function(e,t,i){var n=i(2),o=i(4);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var s={insert:"head",singleton:!1};n(o,s);e.exports=o.locals||{}},function(e,t,i){var n=i(2),o=i(5);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var s={insert:"head",singleton:!1};n(o,s);e.exports=o.locals||{}},function(e,t,i){"use strict";var n,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},s=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),r=[];function a(e){for(var t=-1,i=0;i<r.length;i++)if(r[i].identifier===e){t=i;break}return t}function l(e,t){for(var i={},n=[],o=0;o<e.length;o++){var s=e[o],l=t.base?s[0]+t.base:s[0],d=i[l]||0,h="".concat(l," ").concat(d);i[l]=d+1;var u=a(h),c={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(r[u].references++,r[u].updater(c)):r.push({identifier:h,updater:m(c,t),references:1}),n.push(h)}return n}function d(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var o=i.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var r=s(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var h,u=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function c(e,t,i,n){var o=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=u(t,o);else{var s=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function p(e,t,i){var n=i.css,o=i.media,s=i.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var g=null,v=0;function m(e,t){var i,n,o;if(t.singleton){var s=v++;i=g||(g=d(t)),n=c.bind(null,i,s,!1),o=c.bind(null,i,s,!0)}else i=d(t),n=p.bind(null,i,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=o());var i=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var o=a(i[n]);r[o].references--}for(var s=l(e,t),d=0;d<i.length;d++){var h=a(i[d]);0===r[h].references&&(r[h].updater(),r.splice(h,1))}i=s}}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(r=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),s=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[i].concat(s).concat([o]).join("\n")}var r,a,l;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(n)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(o[r]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);n&&o[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},function(e,t,i){(t=i(3)(!1)).push([e.i,".src-index-module__cross {\n    user-select: none;\n    width: 24px;\n    height: 24px;\n    margin-top: -4px;\n    cursor: pointer;\n}\n\n.src-index-module__label {\n    font-size: 13px;\n    color: #667799;\n    user-select: none;\n    font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n    text-shadow: 1px 0 1px #fff, -1px 0 1px #fff, 0 1px 1px #fff, 0 -1px 1px #fff;\n    white-space: nowrap;\n    cursor: pointer;\n}\n\n.src-index-module__joint {\n    user-select: none;\n    position: absolute;\n    width: 0;\n    height: 0;\n    top: -4px;\n    left: -4px;\n    background: #ffffff;\n    border-radius: 50%;\n    border-style: solid;\n    border-color: #667799;\n    border-width: 4px;\n    box-shadow: 0 0 0 2px #ffffff;\n    cursor: pointer;\n}\n.src-index-module__joint.src-index-module__big {\n    width: 7px;\n    height: 7px;\n    top: -6px;\n    left: -6px;\n    border-width: 3px;\n}\n\n.src-index-module__snap {\n    text-shadow: 1px 0 1px #fff, -1px 0 1px #fff, 0 1px 1px #fff, 0 -1px 1px #fff;\n    user-select: none;\n    color: #667799;\n    font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n    font-size: 13px;\n    margin: -6px 0 0 12px; /** отступы от точки наведения */\n    white-space: nowrap;\n    cursor: pointer;\n}\n",""]),t.locals={cross:"src-index-module__cross",label:"src-index-module__label",joint:"src-index-module__joint",big:"src-index-module__big",snap:"src-index-module__snap"},e.exports=t},function(e,t,i){(t=i(3)(!1)).push([e.i,".src-control-index-module__root {\n    background: #fff;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n    border-radius: 4px;\n    width: 32px;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n.src-control-index-module__button {\n    padding: 0;\n    outline: 0;\n    border: none;\n    cursor: pointer;\n\n    width: 32px;\n    height: 32px;\n    color: #262626;\n    box-sizing: border-box;\n\n    font-size: 18px;\n    font-weight: 400;\n\n    background: #fff;\n}\n\n.src-control-index-module__button:hover {\n    opacity: 0.7;\n}\n\n.src-control-index-module__button:active {\n    color: #028eff;\n}\n\n.src-control-index-module__enabled {\n    color: #028eff;\n}\n",""]),t.locals={root:"src-control-index-module__root",button:"src-control-index-module__button",enabled:"src-control-index-module__enabled"},e.exports=t},function(e,t,i){"use strict";i.r(t);class n{constructor(){this.events={}}on(e,t){let i=this.events[e];return i||(i=this.events[e]=[]),i.push(t),this}once(e,t){const i=n=>{this.off(e,i),t.call(this,n)};return this.on(e,i),this}off(e,t){const i=this.events[e];if(!i)return this;const n=i.indexOf(t);return-1!==n&&i.splice(n,1),this}emit(e,t){const i=this.events[e];if(!i)return this;const n=i.slice();for(let e=0;e<n.length;e++)n[e].call(this,t);return this}}const o={start:{en:"Start",ru:"Старт"},addPoint:{en:"Add point",ru:"Добавить точку"},meter:{en:"m",ru:"м"},kilometer:{en:"km",ru:"км"}};function s(e,t="en"){var i;return null!==(i=o[e][t])&&void 0!==i?i:o[e].en}const r={popupLabelPhase:2147483647,jointLabelPhase:2147483646,areaLabelPhase:2147483645,linePhase:2147483644,jointPhase:2147483643,areaPhase:2147483642,areaColor:"#8899bb77",areaStrokeWidth:0,jointWidth:7,jointBorderWidth:3,jointBorder2Width:2,lineWidth:4,lineBorderWidth:2,lineBorder2Width:1,lineColor:"#667799",lineBorderColor:"#ffffff",lineBorder2Color:"#00000026",previewLineColor:"#66779966",labelFontSize:13,labelColor:"#556688",labelHaloColor:"#fff"};var a=i(0),l=i.n(a);function d(e,t,i){if(void 0===e)return"";if(i=i.toLowerCase(),t)return s("start",i);if(e<1e3)return`${e} ${s("meter",i)}`;return`${(e/1e3).toFixed(1)} ${s("kilometer",i)}`}function h(e,t){const i=Math.PI/180,n=e[1]*i,o=t[1]*i,s=Math.sin((t[1]-e[1])*i/2),r=Math.sin((t[0]-e[0])*i/2),a=s*s+Math.cos(n)*Math.cos(o)*r*r,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return Math.round(6371e3*l)}function u(e,t,i){return new mapgl.Polyline(e,{coordinates:t,zIndex:r.linePhase,zIndex2:r.linePhase-1e-5,zIndex3:r.linePhase-2e-5,width:r.lineWidth,width2:i?0:r.lineWidth+2*r.lineBorderWidth,width3:i?0:r.lineWidth+2*(r.lineBorderWidth+r.lineBorder2Width),color:i?r.previewLineColor:r.lineColor,color2:r.lineBorderColor,color3:r.lineBorder2Color,interactive:!i})}function c(e){return`<div class=${l.a.label}>${e}</div>`}function p(e,t,i){var n;return new mapgl.HtmlMarker(e,{coordinates:t,html:`<div class="${l.a.joint}${i.big?" "+l.a.big:""}"></div`,zIndex:r.jointPhase,interactive:null!==(n=i.interactive)&&void 0!==n&&n})}function g(e,t,i){const n=e[0]-t[0],o=e[1]-t[1],s=i[0]-t[0],r=i[1]-t[1],a=s*s+r*r,l=0!==a?(n*s+o*r)/a:0;return l<0?t:l>1?i:[t[0]+l*s,t[1]+l*r]}function v(e,t,i){var n;const o=t.map(t=>e.project(t.getCoordinates()));let s=1/0,r=o[0],a=0;for(let e=0;e<o.length;e++){const t=g(i,o[e],null!==(n=o[e+1])&&void 0!==n?n:o[0]),l=t[0]-i[0],d=t[1]-i[1],h=l*l+d*d;h<s&&(s=h,r=t,a=e)}const l=e.unproject(r);return{point:l,distance:t[a].getDistance()+h(l,t[a].getCoordinates()),segment:a}}function m(e,t,i){const n=e.getBoundingClientRect();return[t-n.left-e.clientLeft,i-n.top-e.clientTop]}let f=0;class b extends n{constructor(e,t,i,n,o,s){super(),this.map=e,this.showLabel=s,this.dragging=!1,this.hovered=!1,this.onClickPopup=()=>{this.disable(),this.emit("removed",{targetData:this})},this.onMouseOver=()=>{this.hovered||(this.hovered=!0,void 0===this.hoverTimer&&this.emit("mouseover",{targetData:this}))},this.onMouseOut=()=>{this.hovered&&(this.hovered=!1,this.hoverTimer=setTimeout(()=>{this.hovered||(this.emit("mouseout",{targetData:this}),this.hoverTimer=void 0)},100))},this.onMouseMove=e=>{var t;if(!this.dragging)return;this.emit("move",{targetData:this});const i=this.map.getContainer();if("touchmove"===e.type){const t=void 0===e.originalEvent?e:e.originalEvent,n=t.touches[0]||t.changedTouches[0];this.coordinates=this.map.unproject(m(i,n.pageX,n.pageY))}else"mousemove"===e.type&&(this.coordinates=this.map.unproject(m(i,e.clientX,e.clientY)));null===(t=this.marker)||void 0===t||t.setCoordinates(this.coordinates)},this.onMouseUp=()=>{this.dragging&&(this.dragging=!1,this.emit("dragend"))},this.omMouseDown=()=>{this.disablePopup(),this.dragging=!0,this.emit("dragstart",{targetData:this})},this.id=++f,this.distance=n,this.coordinates=t,this.isFirst=i,this.popup=function(e,t){const i=r.labelFontSize,n=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(e,{coordinates:t,html:"",anchor:[-n/2,i/2],zIndex:r.popupLabelPhase,interactive:!0})}(this.map,this.coordinates),o&&this.enable()}destroy(){this.disable(),this.popup.destroy()}disable(){var e,t;this.disablePopup(),null===(e=this.marker)||void 0===e||e.destroy(),this.marker=void 0,null===(t=this.label)||void 0===t||t.destroy(),this.label=void 0,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}enable(){this.marker=p(this.map,this.getCoordinates(),{big:this.isFirst,interactive:!0}),this.addMarkerEventListeners(),this.updateLabel(),document.addEventListener("touchmove",this.onMouseMove),document.addEventListener("mousemove",this.onMouseMove)}getCoordinates(){return this.coordinates}getDistance(){return this.distance}isFirstJoint(){return this.isFirst}setDistance(e,t){this.distance=e,this.isFirst=t,this.hovered?this.enablePopup():this.disablePopup()}setAsFirstJoint(){var e;this.isFirst||(this.isFirst=!0,null===(e=this.marker)||void 0===e||e.destroy(),document.removeEventListener("mouseup",this.onMouseUp),this.marker=p(this.map,this.coordinates,{big:this.isFirst,interactive:!0}),this.addMarkerEventListeners(),this.setDistance(0,!0))}enablePopup(){var e;null===(e=this.label)||void 0===e||e.destroy(),this.popup.setCoordinates(this.coordinates),this.popup.setContent(`<img class=${l.a.cross} src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjIiIGhlaWdodD0iMjIiPjxkZWZzPjxwYXRoIGlkPSJBIiBkPSJNMTIgMTAuNTg2bDMuNzkzLTMuNzkzIDEuNDE0IDEuNDE0TDEzLjQxNCAxMmwzLjc5MyAzLjc5My0xLjQxNCAxLjQxNEwxMiAxMy40MTRsLTMuNzkzIDMuNzkzLTEuNDE0LTEuNDE0TDEwLjU4NiAxMiA2Ljc5MyA4LjIwN2wxLjQxNC0xLjQxNEwxMiAxMC41ODZ6Ii8+PC9kZWZzPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEgLTEpIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMC41IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1vcGFjaXR5PSIuMTUiLz48bWFzayBpZD0iQiIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjQSIvPjwvbWFzaz48dXNlIGZpbGw9IiMwMDAiIGZpbGwtcnVsZT0ibm9uemVybyIgeGxpbms6aHJlZj0iI0EiLz48ZyBmaWxsPSIjMjYyNjI2IiBtYXNrPSJ1cmwoI0IpIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6Ii8+PC9nPjwvZz48L3N2Zz4=" alt="close">`),this.addPopupEventListeners()}disablePopup(){this.popup.setContent(""),this.updateLabel()}setLabelVisibility(e){this.showLabel=e,this.updateLabel()}updateLabel(){var e;null===(e=this.label)||void 0===e||e.destroy(),this.showLabel&&(this.label=function(e,t,i,n){const o=r.labelFontSize,s=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(e,{coordinates:t,html:c(d(i,n,e.getLanguage())),anchor:[-s/2-2,o/2],zIndex:r.jointLabelPhase,interactive:!1})}(this.map,this.coordinates,this.distance,this.isFirst))}addMarkerEventListeners(){if(!this.marker)return;const e=this.marker.getContent();e.addEventListener("mousedown",this.omMouseDown),e.addEventListener("touchstart",this.omMouseDown),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onMouseUp),e.addEventListener("mouseover",this.onMouseOver),e.addEventListener("mouseout",this.onMouseOut)}addPopupEventListeners(){const e=this.popup.getContent();e.addEventListener("mouseover",this.onMouseOver),e.addEventListener("mouseout",this.onMouseOut),e.addEventListener("click",this.onClickPopup)}}class y{constructor(e,t){this.map=e,this.showLabel=t,this.point=[0,0],this.distance=0}update(e){void 0!==e?(this.point=e.point,this.distance=e.distance,this.marker?this.marker.setCoordinates(this.point):this.marker=p(this.map,this.point,{big:!0,interactive:!1}),this.updateLabel()):this.destroy()}destroy(){var e,t;null===(e=this.label)||void 0===e||e.destroy(),null===(t=this.marker)||void 0===t||t.destroy(),this.label=void 0,this.marker=void 0,this.point=[0,0],this.distance=0}setLabelVisibility(e){this.showLabel=e,this.updateLabel()}updateLabel(){var e;null===(e=this.label)||void 0===e||e.destroy(),this.showLabel&&(this.label=function(e,t,i){const n=c(function(e,t){const i=e.getLanguage().toLowerCase(),n=d(t,!1,i),o=s("addPoint",i);return r=n,a=o,`<div class=${l.a.snap}>${r}<br>${a}</div>`;var r,a}(e,i)),o=r.labelFontSize,a=r.jointWidth+r.jointBorderWidth+r.jointBorder2Width;return new mapgl.HtmlMarker(e,{coordinates:t,html:n,anchor:[-a/2,o/2],zIndex:r.jointLabelPhase,interactive:!1})}(this.map,this.point,this.distance))}}const w=e=>e*Math.PI/180;function x(e){const t=e.reduce((e,t)=>({sumX:e.sumX+t[0],sumY:e.sumY+t[1],count:e.count+1}),{sumX:0,sumY:0,count:0});return[t.sumX/t.count,t.sumY/t.count]}class L{constructor(e,t,i){if(this.map=e,this.showLabel=i,this.area=0,this.perimeter=0,this.centroid=[0,0],t.length>2){const e=t.map(e=>e.getCoordinates());this.polygon=M(this.map,e),this.centroid=x(e),this.updateLabel()}}update(e){var t,i;if(null===(t=this.polygon)||void 0===t||t.destroy(),e.length<=2)return this.perimeter=0,this.area=0,void(null===(i=this.label)||void 0===i||i.destroy());const n=e.map(e=>e.getCoordinates());this.centroid=x(n),this.perimeter=e[e.length-1].getDistance()+h(n[n.length-1],n[0]),this.area=function(e){if(e.length<=2)return 0;let t,i,n,o=0;return e.forEach((s,r)=>{t=s,i=e[(r+1)%e.length],n=e[(r+2)%e.length],o+=Math.sin(w(i[1]))*(w(n[0])-w(t[0]))}),o=Math.abs(6371008.8*o*6371008.8)/2,o}(n),this.polygon=M(this.map,n),this.updateLabel()}destroy(){var e,t;null===(e=this.label)||void 0===e||e.destroy(),null===(t=this.polygon)||void 0===t||t.destroy()}getArea(){return this.area}getPerimeter(){return this.perimeter}setLabelVisibility(e){this.showLabel=e,this.updateLabel()}updateLabel(){var e,t,i,n;null===(e=this.label)||void 0===e||e.destroy(),this.showLabel&&(this.label=(t=this.map,i=this.centroid,n=this.area,new mapgl.Label(t,{coordinates:i,text:C(n,t.getLanguage()),zIndex:r.areaLabelPhase,fontSize:r.labelFontSize,color:r.labelColor,haloColor:r.labelHaloColor,haloRadius:1})))}}function C(e,t){return t=t.toLowerCase(),e<1e5?`${e.toFixed(1)} ${s("meter",t)}²`:`${(e/1e6).toFixed(1)} ${s("kilometer",t)}²`}function M(e,t){return new mapgl.Polygon(e,{coordinates:[t],zIndex:r.areaPhase,interactive:!1,color:r.areaColor,strokeWidth:r.areaStrokeWidth})}class P{constructor(e){this.map=e}destroy(){var e;null===(e=this.polyline)||void 0===e||e.destroy(),this.draggableJoint=void 0}getDraggableJoint(){return this.draggableJoint}setDraggableJoint(e){this.draggableJoint=e}update(e,t){var i,n,o;if(null===(i=this.polyline)||void 0===i||i.destroy(),this.draggableJoint){const i=t.indexOf(this.draggableJoint);if(-1===i)return;const s=[];(t[i-1]||"polygon"===e)&&s.push((null!==(n=t[i-1])&&void 0!==n?n:t[t.length-1]).getCoordinates()),s.push(this.draggableJoint.getCoordinates()),(t[i+1]||"polygon"===e)&&s.push((null!==(o=t[i+1])&&void 0!==o?o:t[0]).getCoordinates()),this.polyline=u(this.map,s,!0)}}}class j extends n{constructor(e){super(),this.map=e}update(e,t){var i;if(null===(i=this.polyline)||void 0===i||i.destroy(),0===t.length)return;const n=t.map((e,i)=>{const n=e.getCoordinates(),o=0===i;let s=0;if(!o){s=t[i-1].getDistance()+h(n,t[i-1].getCoordinates())}return e.setDistance(s,o),n});"polygon"===e&&n.push(t[0].getCoordinates()),this.polyline=u(this.map,n,!1),this.polyline.on("mousemove",e=>this.emit("mousemove",e)),this.polyline.on("mouseout",e=>this.emit("mouseout",e)),this.polyline.on("click",e=>this.emit("click",e))}destroy(){var e;null===(e=this.polyline)||void 0===e||e.destroy()}}class _ extends n{constructor(e,t={}){var i,n,o,s,r,a,l,d,h;super(),this.enabled=!1,this.overed=!1,this.joints=[],this.onJointMouseOver=e=>{this.overed=!0,this.previewLine.getDraggableJoint()||e.targetData.enablePopup()},this.onJointMouseOut=e=>{this.overed=!1,this.previewLine.getDraggableJoint()||e.targetData.disablePopup()},this.onJointRemoved=e=>{const t=e.targetData,i=this.joints.indexOf(t);t.isFirstJoint()&&this.joints.length>1&&this.joints[i+1].setAsFirstJoint(),this.joints.splice(i,1),this.redrawFlags.polyline=!0,this.overed=!1,this.sendRulerChangeEvent(!0)},this.onJointMoveEnd=()=>{var e;this.redrawFlags.polyline=!0,this.redrawFlags.preview=!0,null===(e=this.previewLine.getDraggableJoint())||void 0===e||e.enablePopup(),this.previewLine.setDraggableJoint(void 0),this.sendRulerChangeEvent(!0)},this.onJointMove=()=>{this.redrawFlags.preview=!0},this.onJointMoveStart=e=>{e.targetData.disablePopup(),this.previewLine.setDraggableJoint(e.targetData)},this.onPolylineMouseMove=e=>{this.previewLine.getDraggableJoint()||this.overed||(this.newSnapInfo=v(this.map,this.joints,e.point),this.redrawFlags.snap=!0)},this.onPolylineMouseOut=()=>{this.redrawFlags.snap=!0},this.onPolylineClick=e=>{this.createSnapPoint(e.point),this.sendRulerChangeEvent(!0)},this.onClick=e=>{this.addPoint(e.lngLat,this.joints.length),this.sendRulerChangeEvent(!0)},this.map=e,this.mode=null!==(i=t.mode)&&void 0!==i?i:"polyline",this.language=this.map.getLanguage(),this.redrawFlags={polyline:!1,preview:!1,snap:!1},this.labelVisibilitySettings={snapPoint:null===(o=null===(n=t.labelVisibilitySettings)||void 0===n?void 0:n.snapPoint)||void 0===o||o,perimeter:null===(r=null===(s=t.labelVisibilitySettings)||void 0===s?void 0:s.perimeter)||void 0===r||r,area:null===(l=null===(a=t.labelVisibilitySettings)||void 0===a?void 0:a.area)||void 0===l||l},this.snapPoint=new y(this.map,this.labelVisibilitySettings.snapPoint),this.previewLine=new P(this.map),this.polyline=new j(this.map),this.polyline.on("mousemove",this.onPolylineMouseMove),this.polyline.on("mouseout",this.onPolylineMouseOut),this.polyline.on("click",this.onPolylineClick),null===(d=t.points)||void 0===d||d.forEach((e,t)=>this.addPoint(e,t)),(null===(h=t.enabled)||void 0===h||h)&&this.enable()}destroy(){this.disable(),this.joints.forEach(e=>e.destroy()),this.joints=[]}enable(){this.enabled||(this.enabled=!0,this.redrawFlags.polyline=!0,"polygon"===this.mode&&(this.polygon=new L(this.map,this.joints,this.labelVisibilitySettings.area)),this.map.on("click",this.onClick),this.joints.forEach(e=>e.enable()),this.update())}disable(){var e;this.enabled&&(this.enabled=!1,this.polyline.destroy(),this.previewLine.destroy(),this.snapPoint.destroy(),null===(e=this.polygon)||void 0===e||e.destroy(),this.polygon=void 0,this.joints.forEach(e=>e.disable()),this.map.off("click",this.onClick))}setPoints(e){this.redrawFlags.polyline=!0,this.joints.forEach(e=>e.destroy()),this.joints=[],e.forEach((e,t)=>this.addPoint(e,t)),this.sendRulerChangeEvent(!1)}getData(){var e,t,i,n,o,s;switch(this.mode){case"polyline":return{type:this.mode,coordinates:this.joints.map(e=>e.getCoordinates()),lengths:this.joints.map(e=>e.getDistance()),length:this.joints.length>0?null===(e=this.joints[this.joints.length-1])||void 0===e?void 0:e.getDistance():0};case"polygon":const r=this.joints.map(e=>e.getDistance());return(null===(t=this.polygon)||void 0===t?void 0:t.getPerimeter())&&r.push(this.polygon.getPerimeter()),{type:this.mode,coordinates:[this.joints.map(e=>e.getCoordinates())],area:null!==(n=null===(i=this.polygon)||void 0===i?void 0:i.getArea())&&void 0!==n?n:0,perimeter:null!==(s=null===(o=this.polygon)||void 0===o?void 0:o.getPerimeter())&&void 0!==s?s:0,lengths:r};default:throw new Error("unknown mode: "+this.mode)}}setLabelsVisibility(e){var t,i,n,o;this.labelVisibilitySettings={snapPoint:null===(t=e.snapPoint)||void 0===t||t,area:null===(i=e.area)||void 0===i||i,perimeter:null===(n=e.perimeter)||void 0===n||n},this.snapPoint.setLabelVisibility(this.labelVisibilitySettings.snapPoint),null===(o=this.polygon)||void 0===o||o.setLabelVisibility(this.labelVisibilitySettings.area),this.joints.forEach(e=>e.setLabelVisibility(this.labelVisibilitySettings.perimeter)),this.emit("redraw")}addPoint(e,t){this.redrawFlags.polyline=!0;const i=0===this.joints.length;let n=0;if(!i){const i=this.joints[t-1];n=i.getDistance()+h(i.getCoordinates(),e)}const o=new b(this.map,e,i,n,this.enabled,this.labelVisibilitySettings.perimeter);o.on("dragstart",this.onJointMoveStart),o.on("dragend",this.onJointMoveEnd),o.on("move",this.onJointMove),o.on("removed",this.onJointRemoved),o.on("mouseover",this.onJointMouseOver),o.on("mouseout",this.onJointMouseOut),this.joints.splice(t,0,o)}createSnapPoint(e){const t=v(this.map,this.joints,e);this.addPoint(t.point,t.segment+1),this.redrawFlags.snap=!0}sendRulerChangeEvent(e){this.emit("change",{data:this.getData(),isUser:e})}changeLanguage(){var e;this.language=this.map.getLanguage(),this.joints.forEach(e=>e.updateLabel()),this.snapPoint.updateLabel(),null===(e=this.polygon)||void 0===e||e.updateLabel()}update(){var e;if(!this.enabled)return;let t=this.redrawFlags.snap||this.redrawFlags.preview||this.redrawFlags.polyline;this.language!==this.map.getLanguage()&&(this.changeLanguage(),t=!0),this.redrawFlags.polyline&&(this.redrawFlags.polyline=!1,null===(e=this.polygon)||void 0===e||e.update(this.joints),this.polyline.update(this.mode,this.joints)),this.redrawFlags.preview&&(this.redrawFlags.preview=!1,this.previewLine.update(this.mode,this.joints)),this.redrawFlags.snap&&(this.redrawFlags.snap=!1,this.snapPoint.update(this.newSnapInfo),this.newSnapInfo=void 0),t&&this.emit("redraw"),requestAnimationFrame(()=>{this.update()})}}var E=i(1),I=i.n(E);class k extends class{constructor(e,t,i){var n;const{position:o}=i;this._wrap=document.createElement("div"),this._wrap.style.userSelect="none",this._wrap.innerHTML=t,this._position=o,this._controlPane=e._controlPane,this._container=this._controlPane.getContainerByPosition(o),null===(n=this._container)||void 0===n||n.append(this._wrap)}destroy(){this._wrap.remove()}getPosition(){return this._position}setPosition(e){this._container.removeChild(this._wrap),this._container=this._controlPane.getContainerByPosition(e),this._container.append(this._wrap),this._position=e}getContainer(){return this._wrap}}{constructor(e,t){var i,n;super(e,"",t),this.map=e,this.render=()=>{this.getContainer().innerHTML=`\n            <div class=${I.a.root}>\n                <button class="${I.a.button}${this.isEnabled?" "+I.a.enabled:""}"> ${this.icon}</button>\n            </div>\n        `;this.getContainer().querySelector("."+I.a.button).addEventListener("click",this.onClick)},this.onClick=()=>{this.isEnabled?(this.ruler.destroy(),this.isEnabled=!1):(this.ruler.enable(),this.isEnabled=!0),this.render()};const o=null!==(i=t.mode)&&void 0!==i?i:"polyline";switch(this.isEnabled=null===(n=t.enabled)||void 0===n||n,o){case"polyline":this.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="currentColor">\n    <path d="M19 5.59L5.59 19 13 26.41 26.41 13zM8.41 19L10 17.41l2.29 2.3 1.42-1.42-2.3-2.29L13 14.41l2.29 2.3 1.42-1.42-2.3-2.29L16 11.41l2.29 2.3 1.42-1.42-2.3-2.29L19 8.41 23.59 13 13 23.59z" />\n</svg>\n';break;case"polygon":this.icon='<svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M10.7324 8C10.3866 7.4022 9.74028 7 9 7C7.89543 7 7 7.89543 7 9C7 9.74028 7.4022 10.3866 8 10.7324V20V21.2676C7.4022 21.6134 7 22.2597 7 23C7 24.1046 7.89543 25 9 25C9.74028 25 10.3866 24.5978 10.7324 24H21.2676C21.6134 24.5978 22.2597 25 23 25C24.1046 25 25 24.1046 25 23C25 22.2597 24.5978 21.6134 24 21.2676V16.7324C24.5978 16.3866 25 15.7403 25 15C25 13.8954 24.1046 13 23 13C22.8208 13 22.6472 13.0236 22.482 13.0677L18.9323 9.51804C18.9764 9.35282 19 9.17916 19 9C19 7.89543 18.1046 7 17 7C16.2597 7 15.6134 7.4022 15.2676 8H12H10.7324ZM10.7324 22H21.2676C21.4432 21.6964 21.6964 21.4432 22 21.2676V16.7324C21.4022 16.3866 21 15.7403 21 15C21 14.8208 21.0236 14.6472 21.0677 14.482L17.518 10.9323C17.3528 10.9764 17.1792 11 17 11C16.2597 11 15.6134 10.5978 15.2676 10H12H10.7324C10.5568 10.3036 10.3036 10.5568 10 10.7324V20V21.2676C10.3036 21.4432 10.5568 21.6964 10.7324 22Z"/>\n</svg>\n';break;default:throw new Error("unsupported mode: "+o)}this.ruler=new _(this.map,{enabled:this.isEnabled,mode:o}),this.render()}destroy(){this.ruler.destroy(),super.destroy()}getRuler(){return this.ruler}toggle(){this.onClick()}}"undefined"!=typeof window&&("mapgl"in window?(mapgl.Ruler=_,mapgl.RulerControl=k):(window.__mapglPlugins||(window.__mapglPlugins={}),window.__mapglPlugins.Ruler=_,window.__mapglPlugins.RulerControl=k));const S=new mapgl.Map("container",{center:[55.08743147277832,24.80434400280096],zoom:16,key:"cb20c5bf-34d3-4f0e-9b2b-33e9b8edb57f"});window.sdk={map:S,Map:mapgl.Map};const D=new mapgl.Control(S,'\n        <form name="toggle-form" style="display: flex; flex-direction: column;">\n        <div>\n            <input id="polyline" name="mode" type="radio" value="polyline" />\n            <label for="polyline">polyline</label>\n        </div>\n        <div>\n            <input id="polygon" name="mode" type="radio" value="polygon" checked />\n            <label for="polygon">polygon</label>\n        </div>\n        </form>\n    ',{position:"topLeft"}).getContainer().querySelector("form");D&&(D.onchange=e=>{const t=e.target.value;window.control.destroy(),window.control=new k(S,{position:"centerRight",mode:t}),window.ruler=window.control.getRuler()});const z=new mapgl.Control(S,"\n        <select>\n            <option>en</option>\n            <option>ru</option>\n            <option>ar</option>\n        </select>\n    ",{position:"topLeft"}).getContainer().querySelector("select");z&&(z.onchange=()=>{var e;S.setLanguage(null!==(e=z[z.selectedIndex].textContent)&&void 0!==e?e:"en")}),window.control=new k(S,{position:"centerRight",mode:"polygon"}),window.ruler=window.control.getRuler(),window.control.getRuler().setPoints([[55.082101821899414,24.804694608268026],[55.084805488586426,24.799708126178913],[55.09343147277832,24.80434400280096]]),window.addEventListener("resize",()=>S.invalidateSize()),S.on("idle",()=>console.log("map idle")),window.ruler.on("change",()=>console.log("ruler change")),window.ruler.on("redraw",()=>console.log("ruler redraw"))}]);